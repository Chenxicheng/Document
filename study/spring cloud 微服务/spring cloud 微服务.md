## SpringCloud 微服务

### 1. SpringCloud 简介

SpringCloud是基于SpringBoot的一整套实现微服务的框架。它利用SpringBootde的开发便利性简化分布式系统的开发，它提供了微服务开发所需的配置管理、服务发现、断路器、智能路由、微代理、控制总线、全局锁、决策竞选、分布式会话和集群状态管理等组件。SpringCloud并不重复造轮子，而是将市面上开发得比较好的模块集成进去，进行封装，从而减少了各模块的开发成本。换句话说：Spring Cloud 提供了构建分布式系统所需的“全家桶”。

在SpringCloud框架中，主要使用六大组件来构建基础的微服务框架。六大组件分别是服务发现注册组件、配置中心组件、认证中心组件、网关路由组件、服务消费及负载均衡组件和断路器组件。

#### 1.1 服务发现注册组件
  
  Netflix开发的服务发现框架Eureka，基于REST的服务，主要用于AWS云中定位服务，以实现中间层服务器的负载平衡和故障转移。
  
  Eureka提供服务注册和发现。Eureka包含服务端和客户端。
  
  服务应用配置Eureka客户端，启动后Eureka服务端会自动发现并注册服务。在应用启动后，将会向Eureka服务端发送心跳，默认周期为30秒，如果Eureka服务端在多个心跳周期内没有接收到某个应用的心跳，则认为服务宕机，注销该实例，Eureka服务端将会从服务注册表中把这个服务节点移除。
  
  Eureka客户端还有一个内置的负载均衡器，可以进行基本的循环负载均衡。
  
  Eureka服务端做集群部署时，服务端之间通过复制的方式完成数据的同步，同时还提供客户端缓存机制，即多有服务端的挂掉，客户端依然可以利用缓存中的信息消费其他服务。

  Netflix在2018年对Eureka 2.x版本开源不再进行维护，所以在第3节中介绍由阿里开源的Nacos，它实现与Eureka同样的功能。

#### 1.2 配置中心组件
  在微服务中，由于服务数量，为方便多个服务的配置文件的统一管理，实时更新，所以需要配置中心组件来进行管理。
  
  配置中心组件的核心功能，提供服务端和客户端支持、集中管理各环境的配置文件、配置文件修改之后快速的生效、可以进行版本管理、支持大的并发查询、支持各种语言。

  Spring提供SpringCloudConfig组件实现以上核心功能。它包含了客户端和服务端。服务端提供配置文件的存储，集中管理配置文件，动态化的配置更新，以接口的形式将配置文件的内容提供出去；客户端服务应用通过接口获取自己配置信息，初始化应用，当配置发生更新是，服务应用不需要重启即可感知到配置的变化并应用新的配置中。

  SpringCloudConfig服务端存储配置文件分为Git、SVN和本地存储，默认为Git。

  在阿里Nacos中集成了配置中心组件，实现与SpringCloudConfig同样功能，但更易操作和实时更新。

#### 1.3 认证中心组件
  认证中心组件提供身份管理认证服务，用于构建安全的应用程序和服务。

  Spring提供spring security oauth2安全认证框架。

  oauth2 认证授权流程：

  - Resource Owner：资源所有者。即用户。
  - Client：客户端（第三方应用）。
  - Authorization server：授权（认证）服务器。即服务提供商专门用来处理认证的服务器。
  - Resource server：资源服务器，即服务提供商存放用户生成的资源的服务器。它与认证服务器，可以是同一台服务器，也可以是不同的服务器。
  - Access Token：访问令牌。使用合法的访问令牌获取受保护的资源。
  ![blockchain](图片)

  - （A）客户端向资源所有者请求授权。授权请求可以直接对资源所有者(如图所示)进行，或者通过授权服务器作为中介进行间接访问（首选方案）。
  - （B）资源所有者允许授权，并返回凭证（如code）。
  - （C）客户端通过授权服务器进行身份验证，并提供授权凭证（如code），请求访问令牌（access token）。
  - （D）授权服务器对客户端进行身份验证，并验证授权凭证，如果有效，则发出访问令牌。
  - （E）客户端向资源服务器请求受保护的资源，并通过提供访问令牌来进行身份验证。
  - （F）资源服务器验证访问令牌，如果正确则返回受保护资源。

  oauth2根据使用场景不同，分成了4种模式

  - 授权码模式（authorization code）
  - 简化模式（implicit）- 
  - 密码模式（resource owner password credentials）
  - 客户端模式（client credentials）

  在微服务认证授权中通常使用密码模式和客户端模式。授权码模式使用到了回调地址，是最为复杂的方式，通常网站中经常出现的微博，qq第三方登录，都会采用这个形式。简化模式不常用。

  
#### 1.4 网关路由组件

#### 1.5 服务消费及负载均衡组件

#### 1.6 断路器组件



### 2. Nacos 简介


### 3. Sentinel 简介


### 4. Spring-Boot-Admin 简介